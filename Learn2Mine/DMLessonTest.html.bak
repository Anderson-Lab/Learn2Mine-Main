<!DOCTYPE HTML> 
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">

<title>Learn2Mine</title>

<link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />
<link type="text/css" rel="stylesheet" href="/stylesheets/tutorial.css" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<link rel="shortcut icon" href="./images/l2m.ico">
<script type="text/javascript" SRC="./Javascript/jquery.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script type="text/javascript">
/*
function updateProgressBar(problemNumber) {

var correct = 0;
var totalProblems = 0;
var problemsCorrect = new Array();
	if(problemNumber == totalProblems){
		var experience = 100;
	}
	else{
		if( $.inArray(problemNumber,problemsCorrect) === -1 ){
			problemsCorrect.push(problemNumber);
			correct += 1;
			var experience = ((correct*100)/(totalProblems*100))*100;
		}
	}
	$( "#progressbar" ).progressbar({
		value: {{exp}},
	});

};

	function refresh(index,hist_id) {
                outputid = $(".outputid"+index).html();
		$.ajax({
			url: '/OnsiteGrader',
			type: 'GET',
			data: {hist_id:hist_id,outputid:outputid},
			success: function(results){
				$(".results"+index).val("No status yet. Check back again shortly.");
				obj = JSON.parse(results);
				if (obj.return == "correct") {
					$(".results"+index).val("Congratulations! You've solved this problem. ");
					updateProgressBar(index);
					if (obj.badge_image_url != "None") {
						$(".badge"+index).attr("src",obj.badge_image_url)
					        $(".badge"+index).css('display','inline');
					} else {
					        $(".badge"+index).css('display','none');
					}
				} else {
					$(".results"+index).val("The code you entered is incorrect. \nThe following shows what output correctly matched and what output was different (shown using + and -): \n" + obj.difference_stdout);
					$(".badge"+index).attr("src","")
				        $(".badge"+index).css('display','none');
				}
			},
			failure: function(response){
				alert("An error occurred when sending results and your work was not graded. Contact us if this problem persists.");
			},
			statusCode: {
			        500: function() {
		                        $(".results"+index).val("Still starting submission... Hit refresh again.");
                        	}
    			}

		})//.done(alert("done"+code.val()));

	
	}
	$(function() { // Initialize Progress Bar
    	$( "#progressbar" ).progressbar({
    	value: 0
    });
  });
*/
$(function() {
$( "#progressbar" ).progressbar({
value: {{ exp }}
});
});
</script>

</head>

<body>

	<a href="http://birg.cs.cofc.edu/index.php/Anderson_Lab"><img src="/images/Paul-labs-logo.png" align="right" title="BiRG Labs" style="width: 75px;"></a>
	<a id="home" href="Home"><div id="banner"><img id=bannerImg src='images/learn2mine.png' title="LOOK AT BANNER, MICHAEL!"/></a></div>
	<div id="lava">
		<ul>
			<li><a id="home" href="Home"><div class="sitenav" id="homelink">Home</div></a></li>
			<li><a id="profile" href="Profile"><div class="sitenav" id="profilelink">Profile</div></a></li>
			<li><a id="leaderboard" href="Leaderboard"><div class="sitenav" id="leaderlink">Leaderboard</div></a></li>
                        <li><a id="grade" href="Grader"><div class="sitenav" id="gradelink">Grade</div></a></li>
			<li><a id="about" href="About"><div class="sitenav" id="aboutlink">About</div></a></li>
			<li><a id="help" href="Help"><div class="sitenav" id="helplink">Help</div></a></li>
                        <li><a id="rstudio" target="_blank" href="http://portal.cs.cofc.edu/learn2mine-rstudio"><div class="sitenav" id="rstudiolink">Rstudio</div></a></li>
		</ul>
		<div class="loggedin">{{user}}</div>
	</div>
        {% if errorCatch != "yes" %} 
	<div class="container" id="tutorialText">
		<h2>{{header}}</h2>
		<div id="tutorialText">
			<p>
				{{paragraph}}
			</p>
			<p>
				This experience bar represents your strength for taking on the boss fight. Defeat the "boss problem" and you will max out your strength.
			</p>
			<div id="progressbar"></div><div id="progress-label">XP</div>
			<p>
                                Enter your code in the box provided if the answer is not correct, the difference between the answer produces by running the correct solution and yours will be shown.
			</p>
			<p>
				<ol>
					{% for problem in problems %}

						<form name="grade{{ loop.index }}" method="post" id="gradeform" action="/OnsiteGrader">
						<input type="hidden" name="page" value="{{ page }}"/>
						<input type="hidden" name="question" value="{{loop.index}}"/>
						<li>{{ problem }}</li>
						<textarea name="studentCode" class="answer{{ loop.index }}" cols="50" rows="5" placeholder="Enter code or answer here"></textarea>
						<br>
                                                {% if "rcode" in languages %}
				                <input type="submit" name="language" value="Grade R Code">
                                                {% endif %}
                                                {% if "python" in languages %}
				                <input type="submit" name="language" value="Grade Python Code">
                                                {% endif %}
						<p>
						<div class="outputid{{ loop.index }}">
						{% if result[loop.index0] == "Job running" %}
<!--							<form name="refreshResult" method="post" id="refreshResult" action="/RefreshGrade">
							Job is running, click <a href="javascript: submitRefresh()">here</a> to refresh results
							<input type="hidden" name="question" value="{{loop.index}}"/>
							<input type="hidden" name="page" value="{{ page }}"/>
							</form>
-->
							<script type="text/javascript">
							function submitRefresh() {
								document.refreshResult.submit();
							}
							</script>
						{% else %}
							{{ result[loop.index0] }}
						{% endif %}
						</div>
						<br>
					        <textarea class="results{{ loop.index }}" cols="50" rows="5" placeholder="Click refresh to see the results" style="display:none;"></textarea>
					        <br>
					        <input type="button" class="refresh{{ loop.index }}" value="Refresh" style="display:none;" onclick="refresh({{ loop.index }}"/>
						<br>
						<img src="" class="badge{{ loop.index }}" style="display:none;" >
						</form>

					{% endfor %}
				</ol>






				<!--<form method="get" action="">
					<input type="submit" value="Refresh" />
					<br>-->
				<!--</form>-->
				<br>
			</p>
		</div>
	</div>
	{% else %}
            <br><br>
            <center><b>Error in accessing page. Either page does not exist or you do not have access.<br></b>
            <br><br><br>
	{% endif %}

</body>
